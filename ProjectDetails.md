<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# Supabase Device Farm (Mini BrowserStack)

A self-hosted device farm for Android/iOS testing using **Supabase** (no Firebase!). Live device status, APK uploads, and real-time updates. **No auth for now** (easy to add later).

## ğŸ¯ What it does

```
ğŸ“± Connect Android phones via USB â†’ auto-discover â†’ web dashboard
ğŸ“¦ Upload APK â†’ auto-install on devices
ğŸ”„ Live status updates (free/busy/offline)
ğŸš€ Ready for Expo/React Native dev clients
```

**BrowserStack features â†’ 80% cheaper â†’ your own hardware**

***

## ğŸ›’ Hardware (â‚¹50k one-time)

```
Minimum (3 devices):
â”œâ”€â”€ Samsung Galaxy S21 (Android 12) - â‚¹15k used
â”œâ”€â”€ Pixel 6 (Android 13) - â‚¹20k used  
â”œâ”€â”€ USB hub + cables - â‚¹1k
â””â”€â”€ Laptop/Mac with USB ports

Scale later: 10 Android + Mac Mini (iOS sims)
```


***

## ğŸš€ Quick Start (30 mins)

### 1. Supabase Setup

```
1. supabase.com â†’ New project â†’ "device-farm"
2. Storage â†’ Create bucket "apps"
3. SQL Editor â†’ Run ENTIRE SQL below ğŸ‘‡
4. Settings â†’ API â†’ Copy "anon public" and "service role" keys
```

**COMPLETE SQL** (copy-paste into SQL Editor):

```sql
-- Tables
CREATE TABLE public.devices (
  id TEXT PRIMARY KEY,
  type TEXT NOT NULL,
  model TEXT NOT NULL,
  os_version TEXT,
  status TEXT DEFAULT 'offline',
  host_name TEXT,
  stream_url TEXT,
  session_id TEXT,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE public.install_queue (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  device_id TEXT NOT NULL REFERENCES public.devices(id) ON DELETE CASCADE,
  app_path TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Realtime
ALTER PUBLICATION supabase_realtime ADD TABLE public.devices;
ALTER PUBLICATION supabase_realtime ADD TABLE public.install_queue;

-- NO AUTH: Disable RLS
ALTER TABLE public.devices DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.install_queue DISABLE ROW LEVEL SECURITY;
```


### 2. Backend (Device Host)

```
1. Connect Android phone (USB debugging ON)
2. cd backend
   npm install
   npm start
```


### 3. Frontend

```
1. Replace YOUR-PROJECT and YOUR_ANON_KEY in web/index.html
2. Serve it: npx serve web/  (or Vercel/Netlify)
3. Open http://localhost:3000 â†’ INSTANT device farm!
```


***

## ğŸ“± Connect First Android Device

```
Phone settings:
1. Developer options â†’ ON (tap Build Number 7x)
2. USB Debugging â†’ ON
3. Connect USB â†’ "Allow debugging" â†’ Tick "Always"

Backend terminal:
$ npm start
âœ… Starting device host...
âœ… Found device: abc123: Samsung Galaxy S21
âœ… Updated Supabase: status=free

Browser:
Devices Online: 1
â””â”€â”€ Samsung Galaxy S21 (Android 14) [FREE] â†’ Connect
```


***

## ğŸ“¦ Install APK Demo

```
1. Browse â†’ Pick APK file
2. Click "Install APK" on any device
3. Backend auto-downloads + installs:
   $ adb -s abc123 install app.apk
   âœ… Success
```

**"Install on All Free Devices"** button uploads APK to **all** free devices at once!

***

## ğŸ”§ File Structure

```
supabase-device-farm/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ device-host.js     â† Runs on machine with phones
â”‚   â””â”€â”€ package.json
â””â”€â”€ web/
    â”œâ”€â”€ index.html         â† Dashboard (no login!)
    â””â”€â”€ stream.html        â† Device video (future)
```


***

## ğŸ› ï¸ Backend: device-host.js

**Runs continuously** on machine with Android phones connected:

```
What it does:
1. adb devices â†’ Finds all phones every 30s
2. Updates Supabase: model, OS version, status=free
3. Watches install_queue â†’ auto-installs APKs
```

**Your Supabase keys go here**:

```javascript
const SUPABASE_URL = 'https://abc123.supabase.co';
const SUPABASE_SERVICE_ROLE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
```


***

## ğŸŒ Frontend: index.html

**Serve anywhere** (Vercel, Netlify, nginx, `npx serve`).

```
Features:
âœ… Live device list (realtime)
âœ… Reserve device (marks busy)
âœ… Upload APK â†’ auto-install
âœ… "Install All Free" button
âœ… No login (disabled RLS)
```

**Your Supabase anon key**:

```javascript
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
```


***

## ğŸ“Š Scale Up (Week 2)

```
Host 1: Samsung S21 + Pixel 6 â†’ host_name: "android-host-1"
Host 2: OnePlus 9 + Moto G â†’ host_name: "android-host-2"  
Host 3: Mac Mini â†’ iOS simulators â†’ host_name: "ios-host-1"

Dashboard shows:
Samsung Galaxy S21 (Android 14) [FREE] android-host-1
Google Pixel 6 (Android 13)   [FREE] android-host-1
iPhone 14 Simulator (iOS 17)  [FREE] ios-host-1
```


***

## ğŸ’° Cost Breakdown

```
Supabase Free Tier:
âœ… 500K DB rows (10K devices!)
âœ… 50GB storage (1K APKs)
âœ… Unlimited realtime
âœ… 200K API calls/day

Hardware: â‚¹50k (3 Android phones)
Monthly: â‚¹1,500 electricity vs BrowserStack â‚¹25k
```


***

## ğŸ¯ Expo/React Native Integration

```
1. eas build --profile development  â†’ dev-client.apk
2. Upload APK to dashboard
3. Install on Galaxy S21
4. npx expo start --tunnel  (your exp.direct URL)
5. Device connects â†’ Hot reload works!
```

**Exactly like BrowserStack tunnel workflow.**

***

## ğŸš€ Production (Week 4)

```
[ ] Add scrcpy WebRTC streaming (stream.html)
[ ] iOS simulator support (xcrun simctl)
[ ] Re-enable auth (RLS policies)
[ ] Nginx reverse proxy + HTTPS
[ ] Docker containers
[ ] 20+ devices across office
```


***

## ğŸ†˜ Troubleshooting

```
âŒ "No devices found"
â†’ adb devices (phone USB debugging ON?)

âŒ "APK install failed"
â†’ Check backend logs, ensure APK < 100MB

âŒ "Devices offline"
â†’ Backend stopped? npm start

âŒ "Supabase errors"
â†’ Check anon/service keys in code
```


***

## ğŸ“ Next Steps

```
âœ… 1. Supabase project + SQL
âœ… 2. Backend on laptop with 1 phone
âœ… 3. Frontend served locally
âœ… 4. Test APK upload/install
ğŸ”„ 5. Add 2nd phone
ğŸ”„ 6. Deploy frontend to Vercel
ğŸ”„ 7. Scale to 10 devices
```

**Live demo in 30 mins â†’ Production farm in 1 week!** ğŸš€

***

**Save as `README.md` and you're ready to share with your team!** ğŸ‰
